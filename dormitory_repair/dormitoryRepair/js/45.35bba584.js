"use strict";(self["webpackChunkdormitory_repair"]=self["webpackChunkdormitory_repair"]||[]).push([[45],{45:function(t,s,e){e.r(s),e.d(s,{default:function(){return c}});var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"repair-apply-container"},[s("div",{staticClass:"app-header"},[s("div",{staticClass:"header-content"},[s("div",{staticClass:"return-button",on:{click:t.back}},[s("i",{staticClass:"el-icon-arrow-left"})]),s("h1",{staticClass:"page-title"},[t._v("我要报修")])])]),s("div",{staticClass:"form-container"},[s("div",{staticClass:"form-section"},[t._m(0),s("el-card",{staticClass:"form-card",attrs:{shadow:"hover"}},[s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-office-building label-icon"}),t._v(" 报修苑区 ")]),s("el-select",{staticClass:"form-select",class:{"error-border":t.showError.gardenDistrict},attrs:{placeholder:"请选择苑区"},on:{change:t.getBuildings},model:{value:t.upload_list.gardenDistrictValue,callback:function(s){t.$set(t.upload_list,"gardenDistrictValue",s)},expression:"upload_list.gardenDistrictValue"}},t._l(t.gardenDistrict,function(t){return s("el-option",{key:t.key,attrs:{label:t.area,value:t.key}})}),1)],1),s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-school label-icon"}),t._v(" 报修楼栋 ")]),s("el-select",{staticClass:"form-select",class:{"error-border":t.showError.building},attrs:{placeholder:"请先选择苑区",disabled:!t.upload_list.gardenDistrictValue},model:{value:t.upload_list.buildingValue,callback:function(s){t.$set(t.upload_list,"buildingValue",s)},expression:"upload_list.buildingValue"}},t._l(t.buildings,function(t){return s("el-option",{key:t.key,attrs:{label:t.area,value:t.key}})}),1)],1),s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-house label-icon"}),t._v(" 报修寝室 ")]),s("el-input",{staticClass:"form-input",class:{"error-border":t.showError.room},attrs:{placeholder:"请输入寝室号（如101）"},on:{blur:t.validateRoom,input:t.sanitizeRoomInput},model:{value:t.upload_list.room,callback:function(s){t.$set(t.upload_list,"room",s)},expression:"upload_list.room"}}),t.showError.room?s("div",{staticClass:"error-message"},[t._v(" 寝室号格式不正确 ")]):t._e()],1)])],1),s("div",{staticClass:"form-section"},[t._m(1),s("el-card",{staticClass:"form-card",attrs:{shadow:"hover"}},[s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-user-solid label-icon"}),t._v(" 报修人 ")]),s("el-input",{staticClass:"form-input",class:{"error-border":t.showError.name},attrs:{placeholder:"请输入真实姓名"},on:{focus:function(s){return t.clearError("name")}},model:{value:t.upload_list.name,callback:function(s){t.$set(t.upload_list,"name",s)},expression:"upload_list.name"}})],1),s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-mobile-phone label-icon"}),t._v(" 手机号 ")]),s("el-input",{staticClass:"form-input",class:{"error-border":t.showError.phone},attrs:{placeholder:"请输入真实手机号",maxlength:"11"},on:{blur:t.validatePhone,input:t.sanitizePhoneInput},model:{value:t.upload_list.phone,callback:function(s){t.$set(t.upload_list,"phone",s)},expression:"upload_list.phone"}}),t.showError.phone?s("div",{staticClass:"error-message"},[t._v(" 手机号格式不正确，应为11位数字且以1开头 ")]):t._e()],1)])],1),s("div",{staticClass:"form-section"},[t._m(2),s("el-card",{staticClass:"form-card",attrs:{shadow:"hover"}},[s("div",{staticClass:"form-item"},[s("label",{staticClass:"form-label"},[s("i",{staticClass:"el-icon-collection-tag label-icon"}),t._v(" 报修类型 ")]),s("el-select",{staticClass:"form-select",class:{"error-border":t.showError.kindValue},attrs:{placeholder:"请选择报修类型"},model:{value:t.upload_list.kindValue,callback:function(s){t.$set(t.upload_list,"kindValue",s)},expression:"upload_list.kindValue"}},t._l(t.kind,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),s("div",{staticClass:"form-item"},[s("el-input",{staticClass:"form-textarea",class:{"error-border":t.showError.textarea},attrs:{type:"textarea",rows:4,placeholder:"请详细描述报修问题（如：空调不制冷、水管漏水等）",maxlength:"250","show-word-limit":""},on:{focus:function(s){return t.clearError("textarea")}},model:{value:t.upload_list.textarea,callback:function(s){t.$set(t.upload_list,"textarea",s)},expression:"upload_list.textarea"}}),s("div",{staticClass:"form-tips"},[s("i",{staticClass:"el-icon-warning-outline"}),t._v(" 请填写真实准确的报修详情 ")])],1)])],1),s("div",{staticClass:"form-section"},[t._m(3),s("el-card",{staticClass:"form-card",attrs:{shadow:"hover"}},[s("el-upload",{staticClass:"image-uploader",attrs:{"http-request":t.upload,action:"#",accppet:".jpg,.png,.jpeg,.gif,.bmp,webp,svg","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"file-list":t.fileList,limit:4,"before-upload":t.beforeUploadImg,"on-exceed":t.handleExceed}},[s("i",{staticClass:"el-icon-plus"}),s("div",{staticClass:"upload-tips"},[t._v("上传图片")])]),s("el-dialog",{attrs:{visible:t.dialogVisible,width:"90%",top:"5vh"},on:{"update:visible":function(s){t.dialogVisible=s}}},[s("img",{attrs:{width:"100%",src:t.nowImageUrl,alt:"报修问题图片"}})])],1)],1),s("div",{staticClass:"submit-section"},[s("el-button",{staticClass:"submit-button",attrs:{type:"primary",loading:t.submitting},on:{click:t.submit}},[s("i",{staticClass:"el-icon-upload2"}),t._v(" 提交报修申请 ")])],1)])])},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"section-header"},[s("i",{staticClass:"el-icon-location-outline section-icon"}),s("h2",[t._v("报修区域")])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"section-header"},[s("i",{staticClass:"el-icon-user section-icon"}),s("h2",[t._v("报修人信息")])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"section-header"},[s("i",{staticClass:"el-icon-tickets section-icon"}),s("h2",[t._v("报修详情")])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"section-header"},[s("i",{staticClass:"el-icon-picture-outline section-icon"}),s("h2",[t._v("问题图片（选填）")])])}],l=(e(4114),e(8111),e(7588),e(5606),{data(){return{gardenDistrict:[],buildings:[],kind:[{value:"1",label:"空调维修"},{value:"2",label:"热水维修"},{value:"3",label:"网络维修"},{value:"4",label:"其它维修"}],upload_list:{gardenDistrictValue:"",buildingValue:"",room:"",name:"",phone:"",kindValue:"",textarea:"",dialogImageUrl:[],uuid:""},fileUrlMap:{},dialogVisible:!1,nowImageUrl:"",fileList:[],submitting:!1,showError:{gardenDistrict:!1,building:!1,room:!1,name:!1,phone:!1,kindValue:!1,textarea:!1}}},mounted(){this.$axios.get("/area/getGeneral").then(t=>{this.gardenDistrict=t.data})},methods:{sanitizePhoneInput(){this.upload_list.phone=this.upload_list.phone.replace(/\D/g,""),this.showError.phone&&this.validatePhone()},sanitizeRoomInput(){this.upload_list.room=this.upload_list.room.replace(/\D/g,""),this.showError.room&&this.validateRoom()},validatePhone(){const t=this.upload_list.phone;if(!t)return this.showError.phone=!0,!1;const s=/^1[3-9]\d{9}$/;return this.showError.phone=!s.test(t),!this.showError.phone},validateRoom(){const t=this.upload_list.room;if(!t)return this.showError.room=!0,!1;const s=/^\d{3,4}$/;return this.showError.room=!s.test(t),!this.showError.room},upload(t){const s=new FormData;s.append("file",t.file),s.append("uid",t.file.uid),this.$axios.post("http://parliy.com:83/api/student/uploadImg",s,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{this.upload_list.dialogImageUrl.push(s.data.data),this.fileUrlMap[t.file.uid]=s.data.data,this.$message.success("图片上传成功")}).catch(t=>{this.$message.error("图片上传失败")})},handleRemove(t){try{if(!this.upload_list||!this.upload_list.dialogImageUrl)return void console.warn("数据未初始化");const s=this.fileUrlMap[t.uid];if(!s)return void console.warn("未找到对应文件的URL映射");const e=this.upload_list.dialogImageUrl.findIndex(t=>t===s);-1!==e?(this.upload_list.dialogImageUrl.splice(e,1),delete this.fileUrlMap[t.uid],this.$message.success("图片已移除")):console.warn("未在列表中找到对应的图片URL")}catch(s){console.error("移除图片时发生错误:",s),this.$message.error("移除图片失败")}},handlePictureCardPreview(t){this.nowImageUrl=t.url,this.dialogVisible=!0},handleExceed(){this.$message.warning("最多只能上传4张图片")},back(){this.$router.push({path:"/stu/index"})},clearError(t){this.showError[t]=!1},beforeUploadImg(t){const s=t.name.substring(t.name.lastIndexOf(".")+1),e=["jpg","jpeg","png","gif","bmp","webp","svg"];if(-1===e.indexOf(s))return this.$message({message:"上传文件只能是图片",type:"error",center:!0}),!1},validateForm(){let t=!0;const s=["gardenDistrictValue","buildingValue","room","name","phone","kindValue","textarea"];return s.forEach(s=>{this.upload_list[s]?this.showError[s]=!1:(this.showError[s]=!0,t=!1)}),this.validatePhone()||(t=!1),this.validateRoom()||(t=!1),t},submit(){this.validateForm()?(this.submitting=!0,this.upload_list.uuid=localStorage.getItem("dormitory_repair_userId"),this.$axios.post("/student/submit",this.upload_list).then(()=>{this.$message.success("报修申请提交成功"),Object.keys(this.upload_list).forEach(t=>{"dialogImageUrl"!==t&&(this.upload_list[t]="")}),this.upload_list.dialogImageUrl=[],this.fileList=[]}).catch(t=>{console.error(t),this.$message.error("提交失败，请稍后重试")}).finally(()=>{this.submitting=!1})):this.$message.error("请填写完整且格式正确的信息")},getBuildings(){this.$axios.get(`/area/getBuildings?key=${this.upload_list.gardenDistrictValue}`).then(t=>{this.buildings=t.data,this.upload_list.buildingValue=""})}}}),o=l,r=e(1656),n=(0,r.A)(o,a,i,!1,null,"9eb63e58",null),c=n.exports}}]);
//# sourceMappingURL=45.35bba584.js.map