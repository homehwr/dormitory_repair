"use strict";(self["webpackChunkdormitory_repair"]=self["webpackChunkdormitory_repair"]||[]).push([[907],{116:function(t,e,a){var r=a(6518),i=a(9565),s=a(2652),o=a(9306),l=a(8551),n=a(1767),c=a(9539),h=a(4549),d=h("find",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:d},{find:function(t){l(this);try{o(t)}catch(r){c(this,"throw",r)}if(d)return i(d,this,t);var e=n(this),a=0;return s(e,function(e,r){if(t(e,a++))return r(e)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},6907:function(t,e,a){a.r(e),a.d(e,{default:function(){return h}});a(8111),a(1701);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dashboard-container"},[e("div",{staticClass:"header-section"},[t._m(0),e("div",{staticClass:"info-card"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-value"},[t._v(t._s(t.repairData.totalRepairs))]),e("div",{staticClass:"info-label"},[t._v("总报修记录")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-value"},[t._v(t._s(t.repairData.pendingRepairs))]),e("div",{staticClass:"info-label"},[t._v("待维修记录")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-value"},[t._v(t._s(t.repairData.totalWorkers))]),e("div",{staticClass:"info-label"},[t._v("维修工人数")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-value"},[t._v(t._s(t.repairData.totalBuildings))]),e("div",{staticClass:"info-label"},[t._v("楼栋数量")])])])]),e("div",{staticClass:"chart-grid"},[e("div",{staticClass:"chart-card"},[e("div",{staticClass:"chart-header"},[t._m(1),e("div",{staticClass:"chart-filter"},[e("span",[t._v("按苑区: ")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.categoryFilter,expression:"categoryFilter"}],staticClass:"filter-select",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.categoryFilter=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"all"}},[t._v("全部苑区")]),e("option",{attrs:{value:"南苑"}},[t._v("南苑")]),e("option",{attrs:{value:"西苑"}},[t._v("西苑")]),e("option",{attrs:{value:"北苑"}},[t._v("北苑")])])])]),e("div",{ref:"categoryChart",staticClass:"chart-content",staticStyle:{height:"300px"}})]),e("div",{staticClass:"chart-card"},[t._m(2),e("div",{ref:"statusChart",staticClass:"chart-content",staticStyle:{height:"300px"}})]),e("div",{staticClass:"chart-card"},[e("div",{staticClass:"chart-header"},[t._m(3),e("div",{staticClass:"chart-filter"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.trendFilter,expression:"trendFilter"}],staticClass:"filter-select",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.trendFilter=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"7"}},[t._v("近7天")]),e("option",{attrs:{value:"15"}},[t._v("近15天")]),e("option",{attrs:{value:"30"}},[t._v("近30天")])])])]),e("div",{ref:"trendChart",staticClass:"chart-content",staticStyle:{height:"300px"}})]),e("div",{staticClass:"chart-card"},[t._m(4),e("div",{ref:"areaChart",staticClass:"chart-content",staticStyle:{height:"300px"}})]),e("div",{staticClass:"chart-card full-width"},[e("div",{staticClass:"chart-header"},[t._m(5),e("div",{staticClass:"chart-filter"},[e("span",[t._v("排序方式: ")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.ratingSort,expression:"ratingSort"}],staticClass:"filter-select",on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.ratingSort=e.target.multiple?a:a[0]},t.updateRateChart]}},[e("option",{attrs:{value:"desc"}},[t._v("评分从高到低")]),e("option",{attrs:{value:"asc"}},[t._v("评分从低到高")])])])]),e("div",{ref:"rateChart",staticClass:"chart-content",staticStyle:{height:"300px"}})]),e("div",{staticClass:"chart-card full-width"},[e("div",{staticClass:"chart-header"},[t._m(6),e("div",{staticClass:"chart-filter"},[e("span",[t._v("维修类别:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.workerCategoryFilter,expression:"workerCategoryFilter"}],staticClass:"filter-select",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.workerCategoryFilter=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"all"}},[t._v("全部类别")]),t._l(t.workerCategories,function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])})],2),e("span",{staticClass:"info-text"},[t._v("点击图表查看详情")])])]),e("div",{ref:"workerHeatmap",staticClass:"chart-content",staticStyle:{height:"350px"}})])]),e("div",{staticClass:"footer-note"},[e("p",[t._v("数据更新时间: "+t._s(t.currentTime)+" | 当前显示数据为模拟数据")])]),t.workerDetail.visible?e("div",{staticClass:"worker-detail-modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v(t._s(t.workerDetail.name)+" 维修详情")]),e("button",{staticClass:"close-btn",on:{click:t.closeDetail}},[e("i",{staticClass:"close-icon"},[t._v("×")])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"worker-stats"},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.workerDetail.total))]),e("div",{staticClass:"stat-label"},[t._v("维修总量")])]),t.workerDetail.rate?e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.workerDetail.rate)),e("span",{staticClass:"unit"},[t._v("分")])]),e("div",{staticClass:"stat-label"},[t._v("平均评分")])]):t._e()]),e("div",{staticClass:"distribution-chart"},[e("div",{staticClass:"chart-title"},[t._v("维修类别分布")]),e("div",{ref:"distributionChart",staticStyle:{height:"220px",width:"100%"}})])])])]):t._e()])},i=[function(){var t=this,e=t._self._c;return e("h1",[e("i",{staticClass:"icon-repair"}),t._v(" 宿舍报修系统数据看板")])},function(){var t=this,e=t._self._c;return e("h2",[e("i",{staticClass:"icon-category"}),t._v(" 报修类别分布")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"chart-header"},[e("h2",[e("i",{staticClass:"icon-status"}),t._v(" 报修状态统计")])])},function(){var t=this,e=t._self._c;return e("h2",[e("i",{staticClass:"icon-trend"}),t._v(" 报修趋势分析")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"chart-header"},[e("h2",[e("i",{staticClass:"icon-area"}),t._v(" 苑区报修比例")])])},function(){var t=this,e=t._self._c;return e("h2",[e("i",{staticClass:"icon-star"}),t._v(" 维修工评分统计")])},function(){var t=this,e=t._self._c;return e("h2",[e("i",{staticClass:"icon-worker"}),t._v(" 维修工工作统计")])}],s=(a(4114),a(116),a(7588),a(8237),a(6532)),o={data(){return{duty:localStorage.getItem("dormitory_duty"),currentTime:this.formatTime(new Date),categoryFilter:"all",trendFilter:"7",workerCategoryFilter:"all",ratingSort:"desc",workerCategories:["空调","热水","网络","其他"],workerDetail:{visible:!1,name:"",total:0,efficiency:"",avgTime:0,rate:0,repairs:[]},repairData:{totalWorkers:null,pendingRepairs:null,totalRepairs:null,totalBuildings:null,categories:{all:[],"南苑":[],"西苑":[],"北苑":[]},statuses:[],trends:{7:[],15:[],30:[]},areas:[],workers:[],workerRates:[]}}},mounted(){console.log(this.duty),1==this.duty&&this.$router.push("/manage/repair-records"),this.fetchDashboardData(),this.initCharts(),window.addEventListener("resize",this.handleResize),this.timeInterval=setInterval(()=>{this.currentTime=this.formatTime(new Date)},1e3)},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.timeInterval&&clearInterval(this.timeInterval)},watch:{categoryFilter(){this.updateCategoryChart()},trendFilter(){this.updateTrendChart()},workerCategoryFilter(){this.updateWorkerHeatmap()}},methods:{initCharts(){this.initCategoryChart(),this.initStatusChart(),this.initTrendChart(),this.initAreaChart(),this.initRateChart(),this.updateWorkerHeatmap()},formatTime(t){const e={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return new Intl.DateTimeFormat("zh-CN",e).format(t)},initCategoryChart(){this.categoryChart=s.Ts(this.$refs.categoryChart),this.updateCategoryChart()},updateCategoryChart(){const t=this.repairData.categories[this.categoryFilter],e={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",data:t.map(t=>t.name),axisLabel:{fontSize:12}},yAxis:{type:"value",name:"报修数量"},series:[{name:"报修数量",type:"bar",barWidth:"40%",data:t.map(t=>({value:t.value,itemStyle:{color:this.getCategoryColor(t.name)}})),itemStyle:{borderRadius:[8,8,0,0],borderWidth:0},label:{show:!0,position:"top",fontSize:13,fontWeight:"bold",formatter:"{c}"},emphasis:{itemStyle:{shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.3)"}}}]};this.categoryChart.setOption(e)},getCategoryColor(t){const e={"空调":"#5470c6","热水":"#91cc75","网络":"#fac858","其他":"#ee6666"};return e[t]||"#73c0de"},initStatusChart(){this.statusChart=s.Ts(this.$refs.statusChart);const t={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:this.repairData.statuses.map(t=>t.name)},series:[{name:"报修状态",type:"pie",radius:["30%","65%"],center:["40%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold",formatter:"{b}\n{c} ({d}%)"}},labelLine:{show:!1},data:this.repairData.statuses.map(t=>({name:t.name,value:t.value,itemStyle:{color:this.getStatusColor(t.name)}}))}]};this.statusChart.setOption(t),this.statusChart.on("click",t=>{this.$message.success(`过滤状态为 [${t.name}] 的报修记录`)})},getStatusColor(t){const e={"待维修":"#ff7875","已维修":"#5cdbd3","已取消":"#b7eb8f","已转接服务商":"#ffc53d"};return e[t]||"#73c0de"},initTrendChart(){this.trendChart=s.Ts(this.$refs.trendChart),this.updateTrendChart()},updateTrendChart(){const t=this.repairData.trends[this.trendFilter],e={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t.map(t=>t.date)},yAxis:{type:"value"},series:[{name:"报修数量",type:"line",smooth:!0,symbol:"circle",symbolSize:8,lineStyle:{width:3,color:"#1890ff"},areaStyle:{color:new s.fA.W4(0,0,0,1,[{offset:0,color:"rgba(24, 144, 255, 0.5)"},{offset:1,color:"rgba(24, 144, 255, 0.1)"}])},data:t.map(t=>t.value),markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}}]};this.trendChart.setOption(e)},initAreaChart(){this.areaChart=s.Ts(this.$refs.areaChart);const t={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{bottom:0,left:"center",data:this.repairData.areas.map(t=>t.name)},series:[{name:"苑区分布",type:"pie",radius:["40%","70%"],center:["50%","40%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!1},data:this.repairData.areas.map(t=>({name:t.name,value:t.value,itemStyle:{color:this.getAreaColor(t.name)}}))}]};this.areaChart.setOption(t)},initRateChart(){this.rateChart=s.Ts(this.$refs.rateChart),this.updateRateChart()},updateRateChart(){let t=[...this.repairData.workerRates];"desc"===this.ratingSort?t.sort((t,e)=>e.rate-t.rate):t.sort((t,e)=>t.rate-e.rate);const e={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(t){return`${t[0].name}: ${t[0].value}分`}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",data:t.map(t=>t.name),axisLabel:{fontSize:12}},yAxis:{type:"value",name:"评分",min:0,max:5,interval:1},series:[{name:"评分",type:"bar",barWidth:"50%",data:t.map(t=>({value:t.rate,itemStyle:{color:this.getRateColor(t.rate)}})),itemStyle:{borderRadius:[8,8,0,0],borderWidth:0},label:{show:!0,position:"top",fontSize:13,fontWeight:"bold",formatter:"{c}"},emphasis:{itemStyle:{shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.3)"}}}]};this.rateChart.setOption(e)},getRateColor(t){return t>=4.5?"#52c41a":t>=4?"#1890ff":t>=3.5?"#faad14":"#ff4d4f"},updateWorkerHeatmap(){if(!this.$refs.workerHeatmap)return;if(!this.repairData.workers||0===this.repairData.workers.length)return void console.warn("没有维修工数据");this.workerHeatmap&&this.workerHeatmap.dispose(),this.workerHeatmap=s.Ts(this.$refs.workerHeatmap);const t=this.repairData.workers.map(t=>t.name);let e=this.workerCategories;const a=[];"all"!==this.workerCategoryFilter&&(e=[this.workerCategoryFilter]);let r=0;t.forEach((t,i)=>{const s=this.repairData.workers.find(e=>e.name===t);s&&s.categories?e.forEach((t,e)=>{const o=s.categories[t]||0;o>r&&(r=o),a.push([e,i,o])}):console.warn(`维修工 ${t} 数据不完整`,s)}),0===r&&(r=1);const i={tooltip:{position:"top",formatter:function(a){return`${t[a.value[1]]} - ${e[a.value[0]]}<br/>报修数: ${a.value[2]}`}},grid:{top:50,left:100,right:60,bottom:30},xAxis:{type:"category",data:e,splitArea:{show:!0}},yAxis:{type:"category",data:t,splitArea:{show:!0}},visualMap:{min:0,max:r,calculable:!0,orient:"horizontal",left:"center",top:1,inRange:{color:["#d0f0c0","#91cc75","#5470c6"]},textStyle:{fontSize:12}},series:[{name:"维修工工作情况",type:"heatmap",data:a,label:{show:!0,color:"#333",fontSize:12},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};this.workerHeatmap.setOption(i),this.workerHeatmap.off("click"),this.workerHeatmap.on("click",t=>{const e=t.value[1];this.showWorkerDetail(e)})},getWorkerMaxValue(){if("all"===this.workerCategoryFilter)return 45;const t=this.repairData.workers.map(t=>t.categories[this.workerCategoryFilter]||0);return Math.max(...t)},showWorkerDetail(t){const e=this.repairData.workers[t],a=this.repairData.workerRates.find(t=>t.name===e.name);this.workerDetail={visible:!0,name:e.name,total:Object.values(e.categories).reduce((t,e)=>t+e,0),efficiency:e.efficiency,avgTime:e.avgTime,rate:a?a.rate:"暂无",repairs:e.repairs},this.$nextTick(()=>{this.$refs.distributionChart&&this.initDistributionChart(e.categories)})},initDistributionChart(t){const e=s.Ts(this.$refs.distributionChart),a=Object.entries(t).map(([t,e])=>({name:t,value:e})),r={tooltip:{trigger:"item",formatter:"{b}: {c}"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"维修类别",type:"pie",radius:["40%","70%"],center:["40%","50%"],avoidLabelOverlap:!1,itemStyle:{borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}"},data:a.map(t=>({name:t.name,value:t.value,itemStyle:{color:this.getCategoryColor(t.name)}}))}]};e.setOption(r)},closeDetail(){this.workerDetail.visible=!1},getAreaColor(t){const e={"南苑":"#1890ff","西苑":"#52c41a","北苑":"#faad14"};return e[t]||"#73c0de"},handleResize(){this.categoryChart&&this.categoryChart.resize(),this.statusChart&&this.statusChart.resize(),this.trendChart&&this.trendChart.resize(),this.areaChart&&this.areaChart.resize(),this.rateChart&&this.rateChart.resize(),this.workerHeatmap&&this.workerHeatmap.resize()},async fetchDashboardData(){try{const[t,e]=await Promise.all([this.$axios.get("/record/DashboardData"),this.$axios.get("/record/getAllRate")]),a=t.data.dashboardData,r=e.data;console.log("评分数据:",r),this.repairData.workerRates=r,this.repairData.totalRepairs=a.totalRepairs,this.repairData.totalWorkers=a.totalWorkers,this.repairData.pendingRepairs=a.pendingRepairs,this.repairData.totalBuildings=a.totalBuildings,this.repairData.categories.all=a.categories.all,this.repairData.categories.南苑=a.categories.南苑,this.repairData.categories.西苑=a.categories.西苑,this.repairData.categories.北苑=a.categories.北苑,this.repairData.statuses=a.statuses,this.repairData.trends["7"]=a.trends["7"],this.repairData.trends["15"]=a.trends["15"],this.repairData.trends["30"]=a.trends["30"],this.repairData.areas=a.areas,this.repairData.workers=a.workers.map(t=>{const e={};return Object.entries(t.categories).forEach(([t,a])=>{const r=t.replace(/\\"/g,"");e[r]=a}),{...t,categories:e}}),this.$nextTick(()=>{this.initCharts()})}catch(t){console.error("获取仪表盘数据失败:",t)}}}},l=o,n=a(1656),c=(0,n.A)(l,r,i,!1,null,"469caf3b",null),h=c.exports},8237:function(t,e,a){var r=a(6518),i=a(2652),s=a(9306),o=a(8551),l=a(1767),n=a(9539),c=a(4549),h=a(8745),d=a(9039),p=TypeError,u=d(function(){[].keys().reduce(function(){},void 0)}),v=!u&&c("reduce",p);r({target:"Iterator",proto:!0,real:!0,forced:u||v},{reduce:function(t){o(this);try{s(t)}catch(d){n(this,"throw",d)}var e=arguments.length<2,a=e?void 0:arguments[1];if(v)return h(v,this,e?[t]:[t,a]);var r=l(this),c=0;if(i(r,function(r){e?(e=!1,a=r):a=t(a,r,c),c++},{IS_RECORD:!0}),e)throw new p("Reduce of empty iterator with no initial value");return a}})},8745:function(t,e,a){var r=a(616),i=Function.prototype,s=i.apply,o=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(s):function(){return o.apply(s,arguments)})}}]);
//# sourceMappingURL=907.dd84b7de.js.map