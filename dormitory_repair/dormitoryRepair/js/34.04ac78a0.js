"use strict";(self["webpackChunkdormitory_repair"]=self["webpackChunkdormitory_repair"]||[]).push([[34],{397:function(t,r,e){var n=e(7751);t.exports=n("document","documentElement")},679:function(t,r,e){var n=e(1625),i=TypeError;t.exports=function(t,r){if(n(r,t))return t;throw new i("Incorrect invocation")}},684:function(t){t.exports=function(t,r){var e="function"==typeof Iterator&&Iterator.prototype[t];if(e)try{e.call({next:null},r).next()}catch(n){return!0}}},1072:function(t,r,e){var n=e(1828),i=e(8727);t.exports=Object.keys||function(t){return n(t,i)}},1385:function(t,r,e){var n=e(9539);t.exports=function(t,r,e){for(var i=t.length-1;i>=0;i--)if(void 0!==t[i])try{e=n(t[i].iterator,r,e)}catch(o){r="throw",e=o}if("throw"===r)throw e;return e}},1701:function(t,r,e){var n=e(6518),i=e(9565),o=e(9306),s=e(8551),a=e(1767),c=e(9462),l=e(6319),u=e(9539),d=e(684),f=e(4549),h=e(6395),p=!h&&!d("map",function(){}),v=!h&&!p&&f("map",TypeError),m=h||p||v,g=c(function(){var t=this.iterator,r=s(i(this.next,t)),e=this.done=!!r.done;if(!e)return l(t,this.mapper,[r.value,this.counter++],!0)});n({target:"Iterator",proto:!0,real:!0,forced:m},{map:function(t){s(this);try{o(t)}catch(r){u(this,"throw",r)}return v?i(v,this,t):new g(a(this),{mapper:t})}})},1767:function(t){t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},2106:function(t,r,e){var n=e(283),i=e(7294);t.exports=function(t,r,e){return e.get&&n(e.get,r,{getter:!0}),e.set&&n(e.set,r,{setter:!0}),i.f(t,r,e)}},2211:function(t,r,e){var n=e(9039);t.exports=!n(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},2360:function(t,r,e){var n,i=e(8551),o=e(6801),s=e(8727),a=e(421),c=e(397),l=e(4055),u=e(6119),d=">",f="<",h="prototype",p="script",v=u("IE_PROTO"),m=function(){},g=function(t){return f+p+d+t+f+"/"+p+d},y=function(t){t.write(g("")),t.close();var r=t.parentWindow.Object;return t=null,r},w=function(){var t,r=l("iframe"),e="java"+p+":";return r.style.display="none",c.appendChild(r),r.src=String(e),t=r.contentWindow.document,t.open(),t.write(g("document.F=Object")),t.close(),t.F},C=function(){try{n=new ActiveXObject("htmlfile")}catch(r){}C="undefined"!=typeof document?document.domain&&n?y(n):w():y(n);var t=s.length;while(t--)delete C[h][s[t]];return C()};a[v]=!0,t.exports=Object.create||function(t,r){var e;return null!==t?(m[h]=i(t),e=new m,m[h]=null,e[v]=t):e=C(),void 0===r?e:o.f(e,r)}},2529:function(t){t.exports=function(t,r){return{value:t,done:r}}},2787:function(t,r,e){var n=e(9297),i=e(4901),o=e(8981),s=e(6119),a=e(2211),c=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=a?l.getPrototypeOf:function(t){var r=o(t);if(n(r,c))return r[c];var e=r.constructor;return i(e)&&r instanceof e?e.prototype:r instanceof l?u:null}},4114:function(t,r,e){var n=e(6518),i=e(8981),o=e(6198),s=e(4527),a=e(6837),c=e(9039),l=c(function(){return 4294967297!==[].push.call({length:4294967296},1)}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},d=l||!u();n({target:"Array",proto:!0,arity:1,forced:d},{push:function(t){var r=i(this),e=o(r),n=arguments.length;a(e+n);for(var c=0;c<n;c++)r[e]=arguments[c],e++;return s(r,e),e}})},4376:function(t,r,e){var n=e(2195);t.exports=Array.isArray||function(t){return"Array"===n(t)}},4527:function(t,r,e){var n=e(3724),i=e(4376),o=TypeError,s=Object.getOwnPropertyDescriptor,a=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,r){if(i(t)&&!s(t,"length").writable)throw new o("Cannot set read only .length");return t.length=r}:function(t,r){return t.length=r}},4549:function(t,r,e){var n=e(4576);t.exports=function(t,r){var e=n.Iterator,i=e&&e.prototype,o=i&&i[t],s=!1;if(o)try{o.call({next:function(){return{done:!0}},return:function(){s=!0}},-1)}catch(a){a instanceof r||(s=!1)}if(!s)return o}},4659:function(t,r,e){var n=e(3724),i=e(7294),o=e(6980);t.exports=function(t,r,e){n?i.f(t,r,o(0,e)):t[r]=e}},5034:function(t,r,e){e.r(r),e.d(r,{default:function(){return l}});var n=function(){var t=this,r=t._self._c;return r("div",{staticClass:"repair-record-container"},[r("div",{staticClass:"app-header"},[r("div",{staticClass:"header-content"},[r("div",{staticClass:"return-button",on:{click:t.back}},[r("i",{staticClass:"el-icon-arrow-left"})]),r("h1",{staticClass:"page-title"},[t._v("报修记录")])])]),r("div",{staticClass:"content-wrapper"},[t.initialLoading?r("div",{staticClass:"skeleton-container"},t._l(3,function(e){return r("div",{key:e,staticClass:"skeleton-card"},[t._m(0,!0),r("div",{staticClass:"skeleton-body"},t._l(3,function(t){return r("div",{key:t,staticClass:"skeleton-item"},[r("div",{staticClass:"skeleton-icon-small"}),r("div",{staticClass:"skeleton-text-line",style:{width:3===t?"70%":"80%"}})])}),0),t._m(1,!0)])}),0):0!==t.data_list.length||t.loading?r("transition-group",{attrs:{name:"fade-list",tag:"div"}},t._l(t.data_list,function(e,n){return r("div",{key:e.id||n,staticClass:"record-card",on:{click:function(r){return t.toDetail(e.id)}}},[r("div",{staticClass:"card-header"},[r("div",{staticClass:"repair-info"},[r("i",{staticClass:"el-icon-tickets info-icon"}),r("div",{staticClass:"info-text"},[t._v(t._s(e.info))])]),r("div",{staticClass:"status-tag",class:t.getStatusClass(e.status)},[t._v(" "+t._s(e.status)+" ")])]),r("div",{staticClass:"card-body"},[r("div",{staticClass:"info-item"},[r("i",{staticClass:"el-icon-time icon"}),r("span",{staticClass:"label"},[t._v("报修时间：")]),r("span",{staticClass:"value"},[t._v(t._s(e.start_time))])]),r("div",{staticClass:"info-item"},[r("i",{staticClass:"el-icon-location icon"}),r("span",{staticClass:"label"},[t._v("报修寝室：")]),r("span",{staticClass:"value"},[t._v(t._s(e.address+" "+e.address3||"待分配"))])]),e.workerName?r("div",{staticClass:"info-item"},[r("i",{staticClass:"el-icon-user-solid icon"}),r("span",{staticClass:"label"},[t._v("报修人：")]),r("span",{staticClass:"value"},[t._v(t._s(e.name+" "+e.phone||"无"))])]):t._e()]),r("div",{staticClass:"card-footer"},[r("div",{staticClass:"footer-text"},[t._v("点击查看详情")]),r("i",{staticClass:"el-icon-arrow-right arrow-icon"})])])}),0):r("div",{staticClass:"empty-state"},[r("i",{staticClass:"el-icon-document-remove empty-icon"}),r("p",[t._v("暂无报修记录")])]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.data_list.length>0,expression:"data_list.length > 0"}],staticClass:"bottom-tip"},[t.loadingMore?r("div",{staticClass:"loading-more"},[r("i",{staticClass:"el-icon-loading"}),r("span",[t._v("加载中...")])]):t.isAllData?r("span",[t._v("已加载全部记录")]):r("span",[t._v("上拉加载更多")])])],1)])},i=[function(){var t=this,r=t._self._c;return r("div",{staticClass:"skeleton-header"},[r("div",{staticClass:"skeleton-icon"}),r("div",{staticClass:"skeleton-text",staticStyle:{width:"60%"}}),r("div",{staticClass:"skeleton-tag"})])},function(){var t=this,r=t._self._c;return r("div",{staticClass:"skeleton-footer"},[r("div",{staticClass:"skeleton-text-small"})])}],o=(e(4114),e(8111),e(1701),{data(){return{data_list:[],initialLoading:!0,loadingMore:!1,workerId:localStorage.getItem("dormitory_workerId"),offset:0,scrollTimer:null,isLoading:!1,isAllData:!1,errorCount:0,maxErrorCount:3}},computed:{loading(){return this.initialLoading||this.loadingMore}},mounted(){this.initData(),window.addEventListener("scroll",this.handleScroll)},methods:{async initData(){try{this.initialLoading=!0,this.offset=0,this.isAllData=!1,this.data_list=[],await this.loadData()}catch(t){console.error("初始化数据失败:",t),this.$message.error("数据加载失败，请稍后重试")}finally{this.initialLoading=!1}},async loadData(){if(!this.isLoading&&!this.isAllData)if(this.errorCount>=this.maxErrorCount)this.isAllData=!0;else{this.isLoading=!0,this.loadingMore=this.offset>0;try{const t=await this.$axios.get(`/record/getRecordsByWId2?workerId=${this.workerId}&page=${this.offset}`);if(0===t.data.length)return void(this.isAllData=!0);const r=t.data.map(t=>{let r="";switch(t.status){case 0:r="待维修";break;case 1:r="已维修";break;case 2:r="已取消";break;case 3:r="已转服务商";break;default:r="未知状态"}let e=t.start_time;return t.start_time&&t.start_time.length>=19&&(e=t.start_time.substring(0,10)+" "+t.start_time.substring(11,19)),{...t,status:r,start_time:e}});0===this.offset?this.data_list=r:this.data_list=[...this.data_list,...r],t.data.length<10&&(this.isAllData=!0),this.offset+=1,this.errorCount=0}catch(t){console.error("获取报修记录失败:",t),this.errorCount+=1,0===this.offset?this.$message.error("获取报修记录失败，请稍后重试"):this.$message.error("加载更多记录失败")}finally{this.isLoading=!1,this.loadingMore=!1}}},handleScroll(){this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{!this.isScrollToBottom()||this.isLoading||this.isAllData||this.loadData()},150)},isScrollToBottom(){const t=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.clientHeight||document.body.clientHeight,e=document.documentElement.scrollHeight||document.body.scrollHeight;return t+r>=e-50},getStatusClass(t){switch(t){case"待维修":return"status-pending";case"已维修":return"status-completed";case"已取消":return"status-cancelled";case"已转服务商":return"status-transferred";default:return""}},back(){this.$router.push({path:"/worker/index"})},toDetail(t){this.$router.push({name:"workerDetail",params:{id:t}})}},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll),this.scrollTimer&&clearTimeout(this.scrollTimer)}}),s=o,a=e(1656),c=(0,a.A)(s,n,i,!1,null,"64f01bb2",null),l=c.exports},6279:function(t,r,e){var n=e(6840);t.exports=function(t,r,e){for(var i in r)n(t,i,r[i],e);return t}},6319:function(t,r,e){var n=e(8551),i=e(9539);t.exports=function(t,r,e,o){try{return o?r(n(e)[0],e[1]):r(e)}catch(s){i(t,"throw",s)}}},6801:function(t,r,e){var n=e(3724),i=e(8686),o=e(7294),s=e(8551),a=e(5397),c=e(1072);r.f=n&&!i?Object.defineProperties:function(t,r){s(t);var e,n=a(r),i=c(r),l=i.length,u=0;while(l>u)o.f(t,e=i[u++],n[e]);return t}},6837:function(t){var r=TypeError,e=9007199254740991;t.exports=function(t){if(t>e)throw r("Maximum allowed index exceeded");return t}},7657:function(t,r,e){var n,i,o,s=e(9039),a=e(4901),c=e(34),l=e(2360),u=e(2787),d=e(6840),f=e(8227),h=e(6395),p=f("iterator"),v=!1;[].keys&&(o=[].keys(),"next"in o?(i=u(u(o)),i!==Object.prototype&&(n=i)):v=!0);var m=!c(n)||s(function(){var t={};return n[p].call(t)!==t});m?n={}:h&&(n=l(n)),a(n[p])||d(n,p,function(){return this}),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:v}},8111:function(t,r,e){var n=e(6518),i=e(4576),o=e(679),s=e(8551),a=e(4901),c=e(2787),l=e(2106),u=e(4659),d=e(9039),f=e(9297),h=e(8227),p=e(7657).IteratorPrototype,v=e(3724),m=e(6395),g="constructor",y="Iterator",w=h("toStringTag"),C=TypeError,_=i[y],x=m||!a(_)||_.prototype!==p||!d(function(){_({})}),b=function(){if(o(this,p),c(this)===p)throw new C("Abstract class Iterator not directly constructable")},k=function(t,r){v?l(p,t,{configurable:!0,get:function(){return r},set:function(r){if(s(this),this===p)throw new C("You can't redefine this property");f(this,t)?this[t]=r:u(this,t,r)}}):p[t]=r};f(p,w)||k(w,y),!x&&f(p,g)&&p[g]!==Object||k(g,b),b.prototype=p,n({global:!0,constructor:!0,forced:x},{Iterator:b})},9462:function(t,r,e){var n=e(9565),i=e(2360),o=e(6699),s=e(6279),a=e(8227),c=e(1181),l=e(5966),u=e(7657).IteratorPrototype,d=e(2529),f=e(9539),h=e(1385),p=a("toStringTag"),v="IteratorHelper",m="WrapForValidIterator",g="normal",y="throw",w=c.set,C=function(t){var r=c.getterFor(t?m:v);return s(i(u),{next:function(){var e=r(this);if(t)return e.nextHandler();if(e.done)return d(void 0,!0);try{var n=e.nextHandler();return e.returnHandlerResult?n:d(n,e.done)}catch(i){throw e.done=!0,i}},return:function(){var e=r(this),i=e.iterator;if(e.done=!0,t){var o=l(i,"return");return o?n(o,i):d(void 0,!0)}if(e.inner)try{f(e.inner.iterator,g)}catch(s){return f(i,y,s)}if(e.openIters)try{h(e.openIters,g)}catch(s){return f(i,y,s)}return i&&f(i,g),d(void 0,!0)}})},_=C(!0),x=C(!1);o(x,p,"Iterator Helper"),t.exports=function(t,r,e){var n=function(n,i){i?(i.iterator=n.iterator,i.next=n.next):i=n,i.type=r?m:v,i.returnHandlerResult=!!e,i.nextHandler=t,i.counter=0,i.done=!1,w(this,i)};return n.prototype=r?_:x,n}},9539:function(t,r,e){var n=e(9565),i=e(8551),o=e(5966);t.exports=function(t,r,e){var s,a;i(t);try{if(s=o(t,"return"),!s){if("throw"===r)throw e;return e}s=n(s,t)}catch(c){a=!0,s=c}if("throw"===r)throw e;if(a)throw s;return i(s),e}}}]);
//# sourceMappingURL=34.04ac78a0.js.map